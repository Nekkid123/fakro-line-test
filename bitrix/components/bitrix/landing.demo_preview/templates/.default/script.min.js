(function(){"use strict";BX.namespace("BX.Landing");var e=BX.Landing.Utils.slice;var t=BX.Landing.Utils.proxy;var i=BX.Landing.Utils.bind;var n=BX.Landing.Utils.unbind;var r=BX.Landing.Utils.addClass;var o=BX.Landing.Utils.removeClass;var a=BX.Landing.Utils.isNumber;var s=BX.Landing.Utils.style;var l=BX.Landing.Utils.data;var h=BX.Landing.Utils.addQueryParams;var c=BX.Landing.Utils.getDeltaFromEvent;BX.Landing.TemplatePreview=function(){this.closeButton=document.querySelector(".landing-template-preview-close");this.createButton=document.querySelector(".landing-template-preview-create");this.palette=document.querySelector(".landing-template-preview-palette");this.imageContainer=document.querySelector(".preview-desktop-body-image");this.loaderContainer=document.querySelector(".preview-desktop-body-loader-container");this.previewFrame=document.querySelector(".preview-desktop-body-preview-frame");this.loader=new BX.Loader({});this.onCreateButtonClick=t(this.onCreateButtonClick,this);this.onCancelButtonClick=t(this.onCancelButtonClick,this);this.init()};BX.Landing.TemplatePreview.getInstance=function(){return BX.Landing.TemplatePreview.instance||(BX.Landing.TemplatePreview.instance=new BX.Landing.TemplatePreview)};BX.Landing.TemplatePreview.prototype={init:function(){e(this.palette.children).forEach(this.initSelectableItem,this);i(this.closeButton,"click",this.onCancelButtonClick);i(this.createButton,"click",this.onCreateButtonClick);i(this.imageContainer,"mouseover",this.onMouseOver.bind(this));i(this.imageContainer,"mouseleave",this.onMouseLeave.bind(this));void this.showPreview(l(this.palette.querySelector(".active"),"data-src"))},onMouseOver:function(){i(window,!!window.onwheel||BX.browser.IsFirefox()?"wheel":"mousewheel",t(this.onMouseWheel,this));i(window,"touchmove",t(this.onMouseWheel,this))},onMouseLeave:function(){n(window,!!window.onwheel||BX.browser.IsFirefox()?"wheel":"mousewheel",t(this.onMouseWheel,this));n(window,"touchmove",t(this.onMouseWheel,this))},onMouseWheel:function(e){e.stopPropagation();e.preventDefault();var t=c(e);var i=this.previewFrame.contentWindow.scrollY;requestAnimationFrame(function(){this.previewFrame.contentWindow.scrollTo(0,i-t.y)}.bind(this))},showPreview:function(e){return this.showLoader().then(this.createFrameIfNeeded()).then(this.loadPreview(e)).then(this.delay(200)).then(this.hideLoader())},createFrameIfNeeded:function(){return function(){new Promise(function(e){if(!this.previewFrame.style.width){var t=this.imageContainer.clientWidth;void s(this.previewFrame,{width:"1000px",height:"calc((100vh - 140px) * (100 / "+t/1e3*100+"))",transform:"scale("+t/1e3+") translateZ(0)","transform-origin":"top left",border:"none"})}e(this.previewFrame)}.bind(this))}.bind(this)},loadPreview:function(e){return function(){return new Promise(function(t){if(this.previewFrame.src!==e){this.previewFrame.src=e;this.previewFrame.onload=function(){t(this.previewFrame)}.bind(this);return}t(this.previewFrame)}.bind(this))}.bind(this)},showLoader:function(){return new Promise(function(e){void this.loader.show(this.loaderContainer);r(this.imageContainer,"landing-template-preview-overlay");e()}.bind(this))},hideLoader:function(){return function(e){return new Promise(function(t){void this.loader.hide();o(this.imageContainer,"landing-template-preview-overlay");t(e)}.bind(this))}.bind(this)},delay:function(e){e=a(e)?e:0;return function(t){return new Promise(function(i){setTimeout(i.bind(null,t),e)})}},getValue:function(){var e={};e[l(this.palette,"data-name")]=l(this.palette.querySelector(".active"),"data-value");return e},getCreateUrl:function(){return h(this.createButton.getAttribute("href"),this.getValue())},onCancelButtonClick:function(e){e.preventDefault();top.BX.SidePanel.Instance.close()},onCreateButtonClick:function(e){e.preventDefault();this.showLoader().then(this.delay(200)).then(function(){top.location=this.getCreateUrl()}.bind(this))},initSelectableItem:function(e){i(e,"click",t(this.onSelectableItemClick,this))},onSelectableItemClick:function(e){e.preventDefault();o(e.currentTarget.parentElement.querySelector(".active"),"active");r(e.currentTarget,"active");if(e.currentTarget.parentElement===this.palette){this.showPreview(l(e.currentTarget.parentElement.querySelector(".active"),"data-src"))}}}})();