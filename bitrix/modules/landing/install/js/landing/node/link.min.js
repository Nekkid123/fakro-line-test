(function(){"use strict";BX.namespace("BX.Landing");var t=BX.Landing.Utils.trim;var e=BX.Landing.Utils.isPlainObject;var i=BX.Landing.Utils.textToPlaceholders;var n=BX.Landing.Utils.create;BX.Landing.Block.Node.Link=function(t){BX.Landing.Block.Node.apply(this,arguments);if(!this.isGrouped()){this.node.addEventListener("click",this.onClick.bind(this))}if(this.isAllowInlineEdit()){this.node.setAttribute("title",BX.message("LANDING_TITLE_OF_LINK_NODE"))}};BX.Landing.Block.Node.Link.prototype={__proto__:BX.Landing.Block.Node.prototype,constructor:BX.Landing.Block.Node.Link,onContentUpdate:function(){clearTimeout(this.contentEditTimeout);this.contentEditTimeout=setTimeout(function(){BX.Landing.History.getInstance().push(new BX.Landing.History.Entry({block:top.BX.Landing.Block.storage.getByChildNode(this.node).id,selector:this.selector,command:"editLink",undo:this.startValue,redo:this.getValue()}));this.startValue=null}.bind(this),400);this.getField().setValue(this.getValue())},onClick:function(t){t.preventDefault();t.stopPropagation();BX.Landing.UI.Button.FontAction.hideAll();BX.Landing.UI.Button.ColorAction.hideAll();if(!BX.Landing.UI.Panel.StylePanel.getInstance().isShown()){BX.Landing.UI.Panel.Link.getInstance().show(this)}},isPrevented:function(){return this.getValue().target==="_popup"},setValue:function(t,e,i){this.startValue=this.startValue||this.getValue();this.preventSave(e);if(!this.containsImage()){var n=this.getField(true).hrefInput;if(t.text.includes("{{name}}")){n.getPlaceholderData(t.href).then(function(e){this.node.innerHTML=t.text.replace(new RegExp("{{name}}"),'<span data-placeholder="name">'+e.name+"</span>")}.bind(this))}else{if(!this.getField().containsHtml()){this.node.innerHTML=t.text}}}this.node.setAttribute("href",t.href);this.node.setAttribute("target",t.target);if("attrs"in t){for(var a in t.attrs){if(t.attrs.hasOwnProperty(a)){this.node.setAttribute(a,t.attrs[a])}}}else{this.node.removeAttribute("data-url")}this.onChange();if(!i){this.onContentUpdate()}},containsImage:function(){return!!this.node.firstElementChild&&this.node.firstElementChild.tagName==="IMG"},getValue:function(){var n={text:i(t(BX.util.htmlspecialcharsback(this.node.innerHTML))),href:t(this.node.getAttribute("href")),target:t(this.node.getAttribute("target")||"_self")};if(this.node.getAttribute("data-url")){n.attrs={"data-url":t(this.node.getAttribute("data-url"))}}if(this.node.getAttribute("data-dynamic")){if(!e(n.attrs)){n.attrs={}}n.attrs["data-dynamic"]=this.node.getAttribute("data-dynamic")}return n},getField:function(t){var e=this.getValue();e.text=i(n("div",{html:e.text}).innerHTML);if(!this.field){var a=[BX.Landing.UI.Field.LinkURL.TYPE_BLOCK,BX.Landing.UI.Field.LinkURL.TYPE_PAGE];if(BX.Landing.Main.getInstance().options.params.type===BX.Landing.Main.TYPE_STORE){a.push(BX.Landing.UI.Field.LinkURL.TYPE_CATALOG)}this.field=new BX.Landing.UI.Field.Link({title:this.manifest.name,selector:this.selector,content:e,options:{siteId:BX.Landing.Main.getInstance().options.site_id,landingId:BX.Landing.Main.getInstance().id,filter:{"=TYPE":BX.Landing.Main.getInstance().options.params.type}},allowedTypes:a})}else{if(!t){this.field.setValue(e);this.field.content=e;this.field.hrefInput.content=e.href;this.field.hrefInput.makeDisplayedHrefValue()}}return this.field}}})();